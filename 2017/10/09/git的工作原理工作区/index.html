<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="QCc2uxsAKs" />
    <meta name="google-site-verification" content="dHZ9RMdu-ltH7WdrXrfP50S6KvcZNdbkbG05qnf-FXI" />
    
    <title>Rachel</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="" />
    
    <meta name="description" content="git的工作原理工作区秘钥的生成merge跟踪文件https 转为ssh分支##工作流你的本地仓库由 git 维护的三棵“树”组成。第一个是你的 工作目录，它持有实际文件；第二个是 暂存区（Index），它像个缓存区域，临时保存你的改动；最后是 HEAD，它指向你最后一次提交的结果。 git的工作区域1.工作区（working directory） 2.暂存区（stage index） 3.历史记">
<meta property="og:type" content="article">
<meta property="og:title" content="Rachel">
<meta property="og:url" content="https://rachelren.github.io/2017/10/09/git的工作原理工作区/index.html">
<meta property="og:site_name" content="Rachel">
<meta property="og:description" content="git的工作原理工作区秘钥的生成merge跟踪文件https 转为ssh分支##工作流你的本地仓库由 git 维护的三棵“树”组成。第一个是你的 工作目录，它持有实际文件；第二个是 暂存区（Index），它像个缓存区域，临时保存你的改动；最后是 HEAD，它指向你最后一次提交的结果。 git的工作区域1.工作区（working directory） 2.暂存区（stage index） 3.历史记">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://rachelren.github.io/2017/10/09/git的工作原理工作区/work.png">
<meta property="og:updated_time" content="2017-12-19T09:55:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rachel">
<meta name="twitter:description" content="git的工作原理工作区秘钥的生成merge跟踪文件https 转为ssh分支##工作流你的本地仓库由 git 维护的三棵“树”组成。第一个是你的 工作目录，它持有实际文件；第二个是 暂存区（Index），它像个缓存区域，临时保存你的改动；最后是 HEAD，它指向你最后一次提交的结果。 git的工作区域1.工作区（working directory） 2.暂存区（stage index） 3.历史记">
<meta name="twitter:image" content="https://rachelren.github.io/2017/10/09/git的工作原理工作区/work.png">
    

    

    

    <link rel="stylesheet" href="/blog/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/blog/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/blog/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/blog/css/style.css">

    <script src="/blog/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/blog/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/blog/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/blog/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/blog/">主页</a>
                                </li>
                            
                                        
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/blog/about/index.html">关于</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/blog/board">更新日志</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/blog/',
        CONTENT_URL: '/blog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/blog/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    未分类
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-git的工作原理工作区" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/blog/2017/10/09/git的工作原理工作区/" class="article-date">
            <time datetime="2017-10-09T15:08:58.000Z" itemprop="datePublished">2017-10-09</time>
        </a>
    </div>

                
            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h4 id="git的工作原理工作区"><a href="#git的工作原理工作区" class="headerlink" title="git的工作原理工作区"></a>git的工作原理工作区</h4><h4 id="秘钥的生成"><a href="#秘钥的生成" class="headerlink" title="秘钥的生成"></a>秘钥的生成</h4><h4 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h4><h4 id="跟踪文件"><a href="#跟踪文件" class="headerlink" title="跟踪文件"></a>跟踪文件</h4><h4 id="https-转为ssh"><a href="#https-转为ssh" class="headerlink" title="https 转为ssh"></a>https 转为ssh</h4><h4 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h4><p>##工作流<br>你的本地仓库由 git 维护的三棵“树”组成。第一个是你的 工作目录，它持有实际文件；第二个是 暂存区（Index），它像个缓存区域，临时保存你的改动；最后是 HEAD，它指向你最后一次提交的结果。</p>
<h2 id="git的工作区域"><a href="#git的工作区域" class="headerlink" title="git的工作区域"></a>git的工作区域</h2><p>1.工作区（working directory）</p>
<p>2.暂存区（stage index）</p>
<p>3.历史记录区（history）</p>
<p>这三者之间的关系<br><img src="./work.png"></p>
<p>还有另一种表达方式</p>
<ol>
<li>workspace： 工作区</li>
<li>Index／stage： 暂存区</li>
<li>Repository：仓库区（或本地仓库）</li>
<li>Remote： 远程仓库</li>
</ol>
<p><img src="./工作流.png"></p>
<h4 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h4><p>它是你实际持有的文件，是你可以看得到的文件目录</p>
<h4 id="暂存区"><a href="#暂存区" class="headerlink" title="暂存区"></a>暂存区</h4><p>它是一个包含文件索引的目录树，像是一个虚拟的工作区。在这个虚拟的工作区的目录树中，记录了文件名、文件的状态信息（时间戳，文件长度），文件的内容并不存储其中，而是保存在Git对象库（.git／objects）中，文件索引建立了文件和对象库中对象实体之间的对应</p>
<h2 id="git-add-git-commit"><a href="#git-add-git-commit" class="headerlink" title="git add / git commit"></a>git add / git commit</h2><h4 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h4><p>这个命令将工作目录中的变化添加到缓存区<br>它实际上做了两件事：</p>
<ol>
<li>将本地文件的时间戳、长度，当前文档对象的id等信息保存到暂存区中去</li>
<li>将本地文件的内容做一个快照并保存到Git的对象库中。</li>
</ol>
<p><img src="./add.png"></p>
<p>在这个图中，我们可以看到部分 Git 命令是如何影响工作区和暂存区（stage, index）的： </p>
<p>   图中左侧为工作区，右侧为版本库。在版本库中标记为 “index” 的区域是暂存区，标记为 “master” 的是 master 分支所代表的目录树。<br>   //图中我们可以看出此时 “HEAD” 实际是指向 master 分支的一个“游标”。所以图示的命令中出现 HEAD 的地方可以用 master 来替换。<br>   图中的 objects 标识的区域为 Git 的对象库，实际位于 “.git/objects” 目录下 </p>
<p>当对工作区修改或新增文件，执行‘git add’命令时，暂存区的目录树被更新，同时工作区修改或新增的文件内容被写入到对象库中的一个新的对象中，而该对象的ID被记录在暂存区的文件索引中</p>
<h5 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git add &lt;file&gt;</div><div class="line"></div><div class="line">git add &lt;directory&gt;</div><div class="line"></div><div class="line">git add -p</div></pre></td></tr></table></figure>
<p>将<file>中的更改保存到暂存区<br>将<directory>下的更改保存到暂存区<br>开始交互式的保存，你可以选择文件的一部分保存到暂存区。它会向你展示一堆更改，然后等待你输入命令。<code>y</code>将这块更改加入缓存;<code>n</code>忽略这块更改； <code>q</code>推出； </directory></file></p>
<p><img src="./clipboard.png"></p>
<h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><p>当执行这个操作时，暂存区的目录树（快照）将被写到版本库（对象库）中。<br>它记录的是快照，而不是记录差异？？</p>
<h4 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git commit</div><div class="line">git commit -m &apos;message&apos;</div><div class="line">git commit -a</div></pre></td></tr></table></figure>
<ol>
<li><p>提交已缓存的快照，它会运行文本编辑器，等待你输入提交信息。当你完成输入后，保存文件，关闭编辑器，完成提交</p>
</li>
<li><p>提交快照。<message>作为提交信息，不用在运动文本编辑器了。</message></p>
</li>
<li><p>提交一份包含工作目录所有更改的快照，相当于运行了<code>git add</code> 把所有当前目录下的文件加入stage暂存，然后再运行<code>git commit</code></p>
</li>
</ol>
<p>当执行“git status”命令扫描工作区改动的时候，先依据.git/index文件中记录的时间戳、长度等信息判断工作区文件是否改变。如果工作区的文件时间戳改变，说明文件的内容可能被改变，需要打开文件，读取文件内容，和更改前的原始文件相比较（本地文件和与之对应的object库中的文件的内容进行对比），判断文件内容是否被更改。如果文件内容没有改变，则将该文件新的时间戳记录到 .git/index 文件中。因为判断文件是否更改，使用时间戳、文件长度等信息进行比较要比通过文件内容比较要快的多，所以 Git 这样的实现方式可以让工作区状态扫描更快速的执行，这也是 Git 高效的因素之一。 </p>
<h2 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h2><p><code>git status</code>命令显示工作目录和暂存区的状态。你可以看到哪些被缓存了，哪些还没有，以及哪些还未被Git跟踪。status的输出不会告诉你已经提交的信息。如果你想看，就用<code>git log</code>.<br>//TODO<br>这个命令告诉你 <code>git add</code>和<code>git commit</code>的进展？？</p>
<p><img src="./clipboard1.png"></p>
<h2 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h2><p><code>git log</code> 命令显示已经提交的快照。</p>
<p><strong>与git status的区别</strong></p>
<p><code>git status</code>允许你查看工作目录和暂存区，<code>git log</code>只作用于提交的项目历史。</p>
<p><img src="./log.svg"></p>
<h4 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">git log -n &lt;limit&gt; //用 &lt;limit&gt; 限制提交的数量。比如 git log -n 3 只会显示 3 个提交。</div><div class="line">git log --oneline //将每个提交压缩到一行。当你需要查看项目历史的上层情况时这会很有用。</div><div class="line">git log --stat //除了 git log 信息之外，包含哪些文件被更改了，以及每个文件相对的增删行数。</div><div class="line">git log -p //显示代表每个提交的一堆信息。显示每个提交全部的差异（diff），这也是项目历史中最详细的视图。</div><div class="line">git log --author=&quot;&lt;pattern&gt;&quot; //搜索特定作者的提交。&lt;pattern&gt; 可以是字符串或正则表达式。</div><div class="line">git log --grep=&quot;&lt;pattern&gt;&quot; //搜索提交信息匹配特定 &lt;pattern&gt; 的提交。&lt;pattern&gt; 可以是字符串或正则表达式。 </div><div class="line">git log &lt;since&gt;..&lt;until&gt; //只显示发生在 &lt;since&gt; 和 &lt;until&gt; 之间的提交。两个参数可以是提交 ID、分支名、HEAD 或是任何一种引用。</div><div class="line">git log &lt;file&gt; //只显示包含特定文件的提交。查找特定文件的历史这样做会很方便。</div><div class="line"></div><div class="line">git log --graph --decorate --oneline //还有一些有用的选项。--graph 标记会绘制一幅字符组成的图形，左边是提交，右边是提交信息。--decorate 标记会加上提交所在的分支名称和标签。--oneline 标记将提交信息显示在同一行，一目了然。</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>选项</th>
<th>shuoming</th>
</tr>
</thead>
<tbody>
<tr>
<td>-p</td>
<td>按补丁格式显示每个更新之间的差异。</td>
</tr>
<tr>
<td>–stat</td>
<td>显示每次更新的文件修改统计信息。</td>
</tr>
<tr>
<td>–shortstat</td>
<td>只显示 –stat 中最后的行数修改添加移除统计。</td>
</tr>
<tr>
<td>–name-only</td>
<td>仅在提交信息后显示已修改的文件清单。</td>
</tr>
<tr>
<td>–name-status</td>
<td>显示新增、修改、删除的文件清单。</td>
</tr>
<tr>
<td>–abbrev-commit</td>
<td>仅显示 SHA-1 的前几个字符，而非所有的 40 个字符。</td>
</tr>
<tr>
<td>–relative-date</td>
<td>使用较短的相对时间显示（比如，“2 weeks ago”）。</td>
</tr>
<tr>
<td>–graph</td>
<td>显示 ASCII 图形表示的分支合并历史。</td>
</tr>
<tr>
<td>–pretty</td>
<td>使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）。</td>
</tr>
</tbody>
</table>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git log --author=&quot;John Smith&quot; -p hello.py</div></pre></td></tr></table></figure>
<p>这个命令会显示 John Smith 作者对 hello.py 文件所做的所有更改的差异比较（diff)<br>..句法是比较分支很有用的工具。下面的栗子显示了在 some-feature 分支而不在 master 分支的所有提交的概览。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git log --oneline master..some-feature</div></pre></td></tr></table></figure></p>
<h2 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a>git checkout</h2><p>这个命令有三个不同的作用：检出文件，检出提交和检出分枝；<br>检出提交会使工作目录和这个提交完全匹配。你可以用它来查看项目之前的状态，而不改变当前的状态。检出文件使你能够查看某个特定文件的旧版本，而工作目录中剩下的文件不变。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout master</div></pre></td></tr></table></figure>
<p>切换到master分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout &lt;commit&gt; &lt;file&gt;</div></pre></td></tr></table></figure>
<p>回复文件之前的版本。它将工作目录中的<file>文件变成<commit>中那个文件的拷贝，并将它加入缓存区</commit></file></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout &lt;file&gt;</div></pre></td></tr></table></figure>
<p>恢复暂存区的指定文件到工作区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout</div></pre></td></tr></table></figure>
<p>恢复暂存区的所有文件到工作区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout &lt;commit&gt;</div></pre></td></tr></table></figure>
<p>更新工作目录中的所有文件，使得和某个特定提交中的文件一致；</p>
<p>使用<code>git checkout</code>的好处是，当你建立了项目历史之后，git checkout是一种便捷的方式，来将保存的快照‘加载’到你的服务器上去。</p>
<h4 id="分离HEAD"><a href="#分离HEAD" class="headerlink" title="分离HEAD"></a>分离HEAD</h4><p>检出之前的提交是一个只读操作。在查看旧版本的时候绝不会损坏你的仓库。你项目「当前」的状态在    master 上不会变化。在开发的正常阶段，HEAD 一般指向 master 或是其他的本地分支，但当你检出之前提交的时候，HEAD 就不再指向一个分支了————它直接指向一个提交。</p>
<p><img src="./head分离.svg"><br>另外，检出旧文件不影响你仓库的当前状态。你可以在新的快照中像其他文件一样重新提交旧版本。所以在效果上，<code>git checkout</code>的这个用法可以将单个文件回滚到旧版本。</p>
<p><img src="./commitFile.svg"></p>
<h4 id="一个小例子"><a href="#一个小例子" class="headerlink" title="一个小例子"></a>一个小例子</h4><p>这个例子假定你开始了一个疯狂的实验，但你不确定你是否想要保留它。为了帮助你决定，你想看一看你开始实验之前的项目状态。首先，你需要找到你想要看的那个版本的 ID。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git log --oneline</div></pre></td></tr></table></figure>
<p>假设你的项目历史看上去和下面一样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">b7119f2 继续做些丧心病狂的事</div><div class="line">872fa7e 做些丧心病狂的事</div><div class="line">a1e8fb5 对 hello.py 做了一些修改</div><div class="line">435b61d 创建 hello.py</div><div class="line">9773e52 初始导入</div></pre></td></tr></table></figure></p>
<p>你可以这样使用 <code>git checkout</code> 来查看「对 hello.py 做了一些修改」这个提交：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout a1e8fb5</div></pre></td></tr></table></figure></p>
<p>这让你的工作目录和 a1e8fb5 提交所处的状态完全一致。你可以查看文件，编译项目，运行测试，甚至编辑文件而不需要考虑是否会影响项目的当前状态。你所做的一切 都不会 被保存到仓库中。为了继续开发，你需要回到你项目的「当前」状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout master</div></pre></td></tr></table></figure>
<p>这里假定了你默认在 master 分支上开发，我们会在以后的分支模型中详细讨论。</p>
<p>一旦你回到 master 分支之后，你可以使用 <code>git revert</code> 或 <code>git reset</code> 来回滚任何不想要的更改。</p>
<h3 id="检出文件"><a href="#检出文件" class="headerlink" title="检出文件"></a>检出文件</h3><p>如果只是想把文件恢复到之前的版本，可以用这个操作。比如回复道之前一个提交的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout a1e8fb5 hello.py</div></pre></td></tr></table></figure>
<p>检出文件和检出提交不同的地方是：检出文件会影响到你项目的当前的状态的。被重新检出的文件会显示为‘需要提交的更改’，允许你会滚到文件之前的版本。</p>
<h2 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h2><p><code>git revert</code>命令是用来撤销一个已经提交的快照。这个操作是撤销这个提交的更改，但是对这个更改后面的提交是保留的。这避免了Git历史项目的丢失，这一点对项目的版本历史和协作的可靠性是很重要的。</p>
<h4 id="用法-2"><a href="#用法-2" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git revert &lt;commit&gt;//</div></pre></td></tr></table></figure>
<p>生成一个撤消了 <commit> 引入的修改的<strong>新提交</strong>，然后应用到当前分支。</commit></p>
<p><img src="./clipboard2.png"></p>
<h2 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h2><p>也是撤销的一种方法，但是比较危险，因为它是一个永远撤销的动作，无法获得原来的样子。</p>
<h4 id="用法-3"><a href="#用法-3" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset &lt;file&gt;</div></pre></td></tr></table></figure>
<p>从缓存区移除特定文件，但不改变工作目录。它会取消这个文件的缓存，但不覆盖任何改变（如果缓存中和工作目录不一样时，会保留工作目录，只是把这个文件的从缓存中移除）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset</div></pre></td></tr></table></figure>
<p>重设缓存区，匹配最近一次的提交，但工作目录不变，它会取消最近一次暂存的所有文件的缓存，但不更改工作项目的文件，只是给了一次重设缓存快照的机会。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset --hard</div></pre></td></tr></table></figure>
<p>重设缓存区和工作目录，匹配最近的一次提交。除了取消缓存外，<code>--hard</code>标记也重写了所有工作目录中的更改。换句话说，是清除了所有未提交的更改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset &lt;commit&gt;</div></pre></td></tr></table></figure>
<p>将当前分支的末端移到 <commit>，将缓存区重设到这个提交，但不改变工作目录。所有 <commit> 之后的更改会保留在工作目录中，这允许你用更干净、原子性的快照重新提交项目历史。就是将这个 commit之后的所有暂存都取消。</commit></commit></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset --hard &lt;commit&gt;</div></pre></td></tr></table></figure>
<p>将当前分支的末端移到 <commit>，将缓存区和工作目录都重设到这个提交。它不仅清除了未提交的更改，同时还清除了 <commit> 之后的所有提交.</commit></commit></p>
<p><code>git reset</code>这个操作中，没有加<code>--hard</code>的是取消缓存或取消一系列的提交，工作目录不变。但是加上<code>--hard</code>标记是想要重新再来的操作，取消了缓存还把工作目录给修改了。这两个都是永久的操作。</p>
<p><strong>警告</strong><br>当你操作过<commit>并把这个提交推送到公共仓库后，就不能使用<code>git reset</code>,如果你使用这个之后，你会把这个之后的所有提交都撤销，势必会影响他人。</commit></p>
<p><code>移除一个其他团队成员在上面继续开发的提交在协作时会引发严重的问题。当他们试着和你的仓库同步时，他们会发现项目历史的一部分突然消失了。下面的序列展示了如果你尝试重设公共提交时会发生什么。origin/master 是你本地 master 分支对应的中央仓库中的分支。</code></p>
<h2 id="git-clean"><a href="#git-clean" class="headerlink" title="git clean"></a>git clean</h2><p><code>git clean</code>命令是将未跟踪的文件从你的工作目录中移除。这个也是个无法撤销的操作。</p>
<h4 id="用法-4"><a href="#用法-4" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clean -n</div></pre></td></tr></table></figure>
<p>执行一次git clean的『演习』。它会告诉你那些文件在命令执行后会被移除，而不是真的删除它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clean -f</div></pre></td></tr></table></figure></p>
<p>移除当前目录下未被跟踪的文件。-f（强制）标记是必需的，除非 clean.requireForce 配置项被设为了 false（默认为 true）。它 不会 删除 .gitignore 中指定的未跟踪的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clean -f &lt;path&gt;</div></pre></td></tr></table></figure>
<p>移除未跟踪的文件，但限制在某个路径下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clean -df</div></pre></td></tr></table></figure>
<p>移除未跟踪的文件，以及目录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clean -xf</div></pre></td></tr></table></figure>
<p>移除当前目录下未跟踪的文件，以及 Git 一般忽略的文件。</p>
<p><strong>例子</strong><br>如果你在本地仓库中作死之后想要毁尸灭迹，<code>git reset --hard</code> 和 <code>git clean -f</code> 是你最好的选择。运行这两个命令使工作目录和最近的提交相匹配，让你在干净的状态下继续工作。</p>
<h2 id="git-commit-–amend"><a href="#git-commit-–amend" class="headerlink" title="git commit –amend"></a>git commit –amend</h2><h2 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h2><p>它的作用主要还是用来整合不同分支的修改。<br>现在有两个分支，而且有了各自的提交<br><img src="./basic-rebase-1.png"></p>
<p>如果用合并 merge，它的具体操作是.它是把两个分支的最新快照（c3和c4）以及二者最近的共同祖先（c2）进行三方合并，合并的结果是生成一个新的快照（并提交）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout master</div><div class="line">git merge experiment</div></pre></td></tr></table></figure>
<p><img src="./basic-rebase-2.png"></p>
<p>rebase的做法是：可以提取在C4中引入的补丁和修改，然后在C3的基础上应用一次。可以使用rebase命令将提交到某一分支上的所有修改都移至另一个分支上。操作是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout experiment</div><div class="line">git rebase master</div></pre></td></tr></table></figure></p>
<p>它的原理是首先找到这两个分支的最近共同祖先C2， 然后对比当前分支相对于该祖先的历次提交，提取响应的修改并存为零时文件，然后将当前分支指向目标基底C3，最后以此将之前另存为临时文件的修改依序应用。<br><img src="./basic-rebase-3.png"></p>
<p>rebase的做法和merge的做法，结果是一样的，但是rebase使得提交历史更加整洁。在查看一个经过rebase的分支的历史记录时，虽然开发过程时并行的，但是看上去像是串行的，提交历史是一条直线。<br>请注意，无论是通过变基，还是通过三方合并，整合的最终结果所指向的快照始终是一样的，只不过提交历史不同罢了。 变基是将一系列提交按照原有次序依次应用到另一分支上，而合并是把最终结果合在一起。<br><a href="https://github.com/geeeeeeeeek/git-recipes/wiki/2.7-%E9%87%8D%E5%86%99%E9%A1%B9%E7%9B%AE%E5%8E%86%E5%8F%B2" target="_blank" rel="noopener">文档</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA" target="_blank" rel="noopener">文档2</a></p>
<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><p>git remote<br>git fetch<br>git pull</p>
<h2 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h2><p><code>git fetch</code>命令是将提交从远程库倒入到你的本地仓库。拉取下来的提交储存为远程分支，而不是我们一直使用的<strong>普通的本地分支</strong>,他并不会自动合并和修改你当前的工作。当你准备好时你必须手动将其合并入你的工作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git fetch &lt;remote&gt; //拉取仓库中所有的分支。同时会从另一个仓库中下载所有需要的提交和文件。</div><div class="line">git fetch &lt;remote&gt; &lt;branch&gt; //只拉取指定的分支</div></pre></td></tr></table></figure>
<p>当你希望查看其他人的工作进展时，你需要 fetch。fetch 下来的内容表示为一个远程分支，因此不会影响你的本地开发。这是一个安全的方式，在整合进你的本地仓库之前，检查那些提交。类似于 svn update，你可以看到中央仓库的历史进展如何，但它不会强制你将这些进展合并入你的仓库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git log --oneline master..origin/master</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git pull --rebase &lt;remote&gt;</div></pre></td></tr></table></figure>
<p>和上一个命令相同，但使用 git rebase 合并远程分支和本地分支，而不是使用 git merge。</p>
<h2 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h2><h4 id="用法-5"><a href="#用法-5" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push &lt;remote&gt; &lt;branch&gt;</div></pre></td></tr></table></figure>
<p>将指定的分支推送到 <remote> 上，包括所有需要的提交和提交对象。它会在目标仓库中创建一个本地分支。为了防止你覆盖已有的提交，如果会导致目标仓库非快速向前合并时，Git 不允许你 push。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push &lt;remote&gt; --force</div></pre></td></tr></table></figure></remote></p>
<p>和上一个命令相同，但即使会导致非快速向前合并也强制推送。除非你确定你所做的事，否则不要使用 –force 标记。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push &lt;remote&gt; --all</div></pre></td></tr></table></figure></p>
<p>将所有本地分支推送到指定的远程仓库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push &lt;remote&gt; --tags</div></pre></td></tr></table></figure></p>
<p>当你推送一个分支或是使用 –all 选项时，标签不会被自动推送上去。–tags 将你所有的本地标签推送到远程仓库中去。</p>
<h2 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h2><h4 id="用法-6"><a href="#用法-6" class="headerlink" title="用法"></a>用法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch</div></pre></td></tr></table></figure>
<p>列出仓库中所有分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -r //用来查看远程分支</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch &lt;branch&gt;</div></pre></td></tr></table></figure>
<p>创建一个名为 <branch> 的分支。不会 自动切换到那个分支去。</branch></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -d &lt;branch&gt;</div></pre></td></tr></table></figure>
<p>删除指定分支。这是一个安全的操作，Git 会阻止你删除包含未合并更改的分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -D &lt;branch&gt;</div></pre></td></tr></table></figure>
<p>强制删除指定分支，即使包含未合并更改。如果你希望永远删除某条开发线的所有提交，你应该用这个命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -m &lt;branch&gt;</div></pre></td></tr></table></figure>
<p>将当前分支命名为 <branch>。</branch></p>
<h2 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h2><p><img src="./diff.svg"></p>
<h4 id="常用-1"><a href="#常用-1" class="headerlink" title="常用"></a>常用</h4><p><code>git diff</code> 主要是看工作区和暂存区的不同</p>
<p><code>git diff --cached</code> 查看暂存区和HEAD之间的区别（commit之后的和add之后的）</p>
<p><code>git diff HEAD</code> 查看工作区和HEAD的区别</p>
<h2 id="git-log-1"><a href="#git-log-1" class="headerlink" title="git log"></a>git log</h2><h2 id="git-reflog／git-log-g"><a href="#git-reflog／git-log-g" class="headerlink" title="git reflog／git log -g"></a>git reflog／git log -g</h2><p>能对git 误操作进行数据修复。</p>
<p><a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA" target="_blank" rel="noopener">git 文档</a></p>

        </div>
        <footer class="article-footer">
            



    <a data-url="https://rachelren.github.io/2017/10/09/git的工作原理工作区/" data-id="cjenxrr1b0007trvs970bxymm" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/RachelRen" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/blog/2017/10/22/git/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            git 的常用命令
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/blog/2017/08/03/redux源码/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">redux源码解析</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2018/03/10/redux/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/blog/2018/03/10/redux/" class="title">Redux</a></p>
                            <p class="item-date"><time datetime="2018-03-10T11:03:51.000Z" itemprop="datePublished">2018-03-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2018/03/10/react基础/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/blog/2018/03/10/react基础/" class="title">react基础</a></p>
                            <p class="item-date"><time datetime="2018-03-10T09:04:37.000Z" itemprop="datePublished">2018-03-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2018/03/09/css规范/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/blog/2018/03/09/css规范/" class="title">前端规范--css篇</a></p>
                            <p class="item-date"><time datetime="2018-03-09T06:45:34.000Z" itemprop="datePublished">2018-03-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2018/03/08/原型对象/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/blog/2018/03/08/原型对象/" class="title">原型链</a></p>
                            <p class="item-date"><time datetime="2018-03-08T03:21:38.000Z" itemprop="datePublished">2018-03-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2018/03/07/react router 4 code split/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/blog/2018/03/07/react router 4 code split/" class="title">react router 4的代码分割</a></p>
                            <p class="item-date"><time datetime="2018-03-07T03:23:07.000Z" itemprop="datePublished">2018-03-07</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/03/">三月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/02/">二月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/01/">一月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/12/">十二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/11/">十一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/10/">十月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/08/">八月 2017</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>


            
                

            
                

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/blog/" class="logo"></a>
                </h1>
                <p>&copy; 2018 Rachel Ren</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://rachelren.github.io/2017/10/09/git的工作原理工作区/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/blog/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/blog/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/blog/js/main.js"></script>

    </div>
</body>
</html>
